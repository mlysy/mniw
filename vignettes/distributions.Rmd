---
title: "Distributions Provided by the `mniw` Package"
author: "Martin Lysy"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Distributions provided by mniw}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Wishart and Inverse-Wishart Distributions

The Wishart distribution on a random positive-definite matrix $X_{q\times q}$ is is denoted $X \sim \mathrm{Wish}(\Psi, \nu)$, and defined as $X = (L Z)(L Z)'$, where 

- $\Psi_{q\times q} = LL'$ is the positive-definite matrix scale parameter,
- $\nu > q$ is the shape parameter, 

and $Z_{q\times q}$ is a random lower-triangular matrix with elements
$$
Z_{ij} \begin{cases} 
       \stackrel{\mathrm{iid}}{\sim} \mathcal N(0,1) & i < j \\ 
       \stackrel{\mathrm{ind}}{\sim} \chi^2_{(\nu-i+1)} & i = j \\
       = 0 & i > j.
       \end{cases}
$$

The log-density of the Wishart distribution is
$$
\log p(X \mid \Psi, \nu) = -\tfrac{1}{2} \left[\mathrm{tr}(\Psi^{-1} X) + (q+1-\nu)\log |X| + \nu \log |\Psi|  + \nu q \log(2) + 2 \log \Gamma_q(\tfrac \nu 2)\right],
$$
where  $\Gamma_n(x)$ is the multivariate Gamma function defined as
$$
\Gamma_n(x) = \pi^{n(n-1)/4} \prod_{j=1}^n \Gamma\big(x + \tfrac 1 2 (1-j)\big).
$$

The Inverse-Wishart distribution $X \sim \mathrm{InvWish}(\Psi, \nu)$ is defined as $X^{-1} \sim \mathrm{Wish}(\Psi^{-1}, \nu)$.  Its log-density is given by
$$
\log p(X \mid \Psi, \nu) = -\tfrac 1 2 \left[\mathrm{tr}(\Psi X^{-1}) + (\nu+q+1) \log |X| - \nu \log |\Psi| + \nu q \log(2) + 2 \log \Gamma_q(\tfrac \nu 2)\right].
$$

## Matrix-Normal Distribution

The Matrix-Normal distribution on a random matrix $X_{p \times q}$ is denoted $X \sim \mathrm{MatNorm}(\Lambda, \Sigma_R, \Sigma_C)$, and defined as $X = LZ U + \Lambda$, where

- $\Lambda_{p \times q}$ is the mean matrix parameter,
- ${\Sigma_R}_{p \times p} = LL'$ is the row-variance matrix parameter,
- ${\Sigma_C}_{q \times q} = U'U$ is the column-variance matrix parameter,

and $Z_{q\times q}$ is a random matrix with $Z_{ij} \stackrel{\mathrm{iid}}{\sim} \mathcal N(0,1)$.

The log-density of the Matrix-Normal distribution is
$$
\log p(X \mid \Lambda, \Sigma_R, \Sigma_C) = -\tfrac 1 2 \left[\mathrm{tr}\big(\Sigma_C^{-1}(X-\Lambda)'\Sigma_R^{-1}(X-\Lambda)\big) + \nu q \log(2\pi) + \nu \log |\Sigma_C| + q \log |\Sigma_R|\right].
$$

## Matrix-Normal Inverse-Wishart Distribution

The Matrix-Normal Inverse-Wishart Distribution on a random matrix $X_{p \times q}$ and random positive-definite matrix $V_{q\times q}$ is denoted $(X,V) \sim \mathrm{MNIW}(\Lambda, \Sigma, \Psi, \nu)$, and defined as
$$
\begin{aligned}
V & \sim \mathrm{InvWish}(\Psi, \nu) \\
X \mid V & \sim \mathrm{MatNorm}(\Lambda, \Sigma, V).
\end{aligned}
$$

## Random-Effects Normal Distribution

Consider the multivariate normal distribution on $q$-dimensional vectors $x$ and $\mu$ given by
$$
\begin{aligned}
\mu & \sim \mathcal N(0, \Sigma_\mu) \\
x \mid \mu & \sim \mathcal N(\mu, \Sigma_x).
\end{aligned}
$$
The random-effects normal distribution is defined as the posterior distribution $\mu \sim p(\mu \mid x)$, which is given by
$$
\mu \mid x \sim \mathcal N\big(G x, G\Sigma_X\big), \qquad G = \Sigma_\mu(\Sigma_x + \Sigma_\mu)^{-1}.
$$

## Hierarchical Normal-Normal Model

The hierarchical Normal-Normal model is defined as
$$
\begin{aligned}
y_i \mid \mu_i, \beta, \Sigma & \stackrel{\mathrm{ind}}{\sim} \mathcal N(\mu_i, V_i) \\
\mu_i \mid \beta, \Sigma & \stackrel{\mathrm{iid}}{\sim} \mathcal N(x_i'\beta, \Sigma) \\
(\beta, \Sigma) & \sim \mathrm{MNIW}(\Lambda, \Omega, \Psi, \nu).
\end{aligned}
$$
